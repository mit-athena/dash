/*
 *  Imakefile for Athena Dashboard
 *  Copyright (c) 1991, Massachusetts Institute of Technology
 *		
 *   $Source: /afs/dev.mit.edu/source/repository/athena/bin/dash/src/dash/Imakefile,v $
 *   $Author: vanharen $ 
 *
 * Copyright 1990, 1991 by the Massachusetts Institute of Technology. 
 *
 * For copying and distribution information, please see the file
 * <mit-copyright.h>. 
 *
 */

#include "../Xj.defs"

#include "mit-copyright.h"

DASH		=	dash
DASHRESOURCES	=	Dash
COMPILE		=	compile_menu

#if defined(HaveKerberos)
K_DEF		=	-DKERBEROS
K_LIB		=	-lkrb
K_SRC		=	klist.c
K_OBJ		=	klist.o
#else  /* HaveKerberos */
K_DEF		=
K_LIB		=
K_LIST		=
K_OBJ		=
#endif /* HaveKerberos */

#if defined(HaveAttach)
A_DEF		=	-DATTACH
#else  /* HaveAttach */
A_DEF		=
#endif /* HaveAttach */


CMP_OBJS        =       compile_menu.o
CMP_SRCS	=	compile_menu.c

OBJS		=	dash.o ${K_OBJ}
SRCS		=	dash.c ${K_SRC}

XJLIB		=	../lib/libXj.a
D_LIBS		=	${LOCAL_LIBS} ${XJLIB} ${XLIB} \
			${XMULIB} ${K_LIB} ${M_LIB}
CMP_LIBS	=	${LOCAL_LIBS} ${XJLIB} -lX11

#if (HasPutenv)
PUTENV_DEF	=	-DHAS_PUTENV
#else
PUTENV_DEF	=
#endif

#if  defined(UltrixArchitecture) \
  || defined(AIXArchitecture) \
  || defined(MacIIArchitecture) \
  || defined(SunArchitecture)
ERRNO_DEF	=	-DNEED_ERRNO_DEFS
#else
ERRNO_DEF	=
#endif

#if defined(MacIIArchitecture)
M_LIB		=	-lmalloc
MAC_DEF		=	-DMAC_ARCH
#else
M_LIB		=
MAC_DEF		=
#endif

#if defined(AIXArchitecture)
AIX_DEF		=	-D_BSD -D_BSD_INCLUDES
#else
AIX_DEF		=
#endif

#if defined(RsArchitecture)
RS_DEF		=	-DRS_ARCH
#else
RS_DEF		=
#endif

DEFINES		=	${PUTENV_DEF} ${ERRNO_DEF} \
			${K_DEF} ${A_DEF} ${MAC_DEF} ${AIX_DEF} ${RS_DEF}
INCLUDES	=	-I.. ${LOCAL_INCLUDES}


AllTarget(${COMPILE})
AllTarget(${DASH})
AllTarget(${DASHRESOURCES})

NormalProgramTarget($(COMPILE),$(CMP_OBJS),$(XJLIB),,$(CMP_LIBS))
NormalProgramTarget($(DASH),$(OBJS),$(XJLIB),,$(D_LIBS))
InstallProgram($(DASH),$(DASH_BIN_DIR))

InstallNonExec(${DASH}.1,${MAN_DIR}/${DASH}.1)
InstallNonExec(${DASHRESOURCES},${DASH_APP_DIR}/${DASHRESOURCES})
InstallNonExec(arrow,${DASH_XBM_DIR}/arrow)
InstallNonExec(question,${DASH_XBM_DIR}/question)
InstallNonExec(Dash.xbm,${DASH_XBM_DIR}/Dash.xbm)

DependTarget()

$(DASHRESOURCES): Dash.pre-sed
	${RM} ${DASHRESOURCES}
	sed -e "s,DASH_MENUS,$(DASH_MENUS)," Dash.pre-sed | \
	sed -e "s,DASH_FALLBACK,$(DASH_FALLBACK)," > $(DASHRESOURCES)

compile_menu.o:	compile_menu.c
	${CC} -c -DMENU_COMPILER ${CFLAGS} compile_menu.c

clean::
	${RM} strings
	${RM} x.c

/* .c.o:
 *	${CC} ${CFLAGS} -E $*.c | xstr -c -
 *	${CC} ${CFLAGS} -c x.c
 *	mv x.o $*.o
 *	${RM} x.c
 *
 *xs.o:
 *	xstr
 *	${CC} ${CFLAGS} -c xs.c
 */
