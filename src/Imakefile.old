/*
 *  Imakefile for Athena Dashboard
 *  Copyright (c) 1991, Massachusetts Institute of Technology
 *		
 *   $Source: /afs/dev.mit.edu/source/repository/athena/bin/dash/src/Imakefile.old,v $
 *   $Author: vanharen $ 
 *
 * Copyright 1990, 1991 by the Massachusetts Institute of Technology. 
 *
 * For copying and distribution information, please see the file
 * <mit-copyright.h>. 
 *
 */

#include "mit-copyright.h"

#ifndef HaveKerberos
#define HaveKerberos
#endif

DASH		=	dash
CONSOLE		=	console
SINTABLE	=	sintable

CONSOLERESOURCES=	Console console.xbm gray
DASHRESOURCES	=	Dash
DASHBITMAPS	=	arrow question

#if defined(_AIX)
SPECIALOBJS	=	strcasecmp.o
#else
#if defined(ibm032) || (defined(vax) && !defined(ultrix))
SPECIALOBJS	=	vsprintf.o
#else
SPECIALOBJS	=
#endif
#endif

#ifdef _AUX_SOURCE
M_LIB		=	-lmalloc
#else
M_LIB		=
#endif

#if defined(HaveKerberos)
K_DEF		=	-DKERBEROS
K_LIB		=	-lkrb
#else  /* HaveKerberos */
K_DEF		=
K_LIB		=
#endif /* HaveKerberos */


COREOBJS	=	Jets.o hash.o registerCallbacks.o \
			Label.o Icon.o Form.o Button.o Window.o ${SPECIALOBJS}
DASHOBJS	=	dash.o Tree.o Menu.o DClock.o AClock.o \
			klist.o warn.o

UNUSED		=	StripChart.o get_load.o get_cpu.o

CONSOLEOBJS	=	console.o ScrollBar.o TextDisplay.o xselect.o
D_OBJS		=	${COREOBJS} ${DASHOBJS}
C_OBJS		=	${COREOBJS} ${CONSOLEOBJS}
SIN_OBJS	=	sintable.o

CFILES		=	dash.c console.c hash.c registerCallbacks.c \
			Jets.c AClock.c Button.c DClock.c Form.c Icon.c \
			Label.c Menu.c ScrollBar.c \
			TextDisplay.c Tree.c Window.c \
			xselect.c \
			strcasecmp.c vsprintf.c \
			sintable.c klist.c warn.c

NOTUSED		=	StripChart.c get_load.c get_cpu.c

D_LIBS		=	-lXext -lX11 -lXmu ${K_LIB} ${M_LIB}
C_LIBS		=	-lXext -lX11 ${M_LIB}
SIN_LIBS	=	-lm

#if defined(ibm032)
DEFINES		=	-DSHAPE ${K_DEF} -D_BSD -D_BSD_INCLUDES \
			-DAIXV=12 -DAPPDEFDIR=\"${ATHXAPPDIR}\" \
			-DBITMAPDIR=\"${ATHXBITDIR}\"
#else
DEFINES		=	-DSHAPE ${K_DEF} -DAPPDEFDIR=\"${ATHXAPPDIR}\" \
			-DBITMAPDIR=\"${ATHXBITDIR}\"
#endif

MENUFLAGS	=	`sh -c "if [ $(MACHINE)x = mipsx ]; then echo; else echo $${CFLAGS}; fi"`


AnsiCC()

all::	sintable.h

build_program(${SINTABLE},${SIN_OBJS},,${SIN_LIBS})
create_dir(/etc/athena/login)
SimpleProgram(${DASH},${D_OBJS},${D_LIBS},${ATHBINDIR}/${DASH})

static_program($(CONSOLE),$(C_OBJS),,$(C_LIBS))
install_program($(CONSOLE),,$(ATHRETCDIR))

install_man(${DASH}.1,${DASH}.1)
install_man(${CONSOLE}.8,${CONSOLE}.8)
install_file(${DASHRESOURCES},${ATHXAPPDIR}/${DASHRESOURCES})
install_file(arrow,${ATHXBITDIR})
install_file(question,${ATHXBITDIR})
install_file(Dash.xbm,${ATHXBITDIR})
install_file(Console,/etc/athena/login)
install_file(console.xbm,/etc/athena/login)
install_file(gray,/etc/athena/login)
install_file(/afs/athena.mit.edu/system/config/dash/`machtype`/Dash.menus.73,/usr/athena/lib/Dash.fallback)
create_depend(${CFILES})

install::
	${RM} $(DESTDIR)/usr/athena/lib/Dash.menus
	ln -s /afs/athena.mit.edu/system/config/dash/`machtype`/Dash.menus.73 $(DESTDIR)/usr/athena/lib/Dash.menus

sintable.h: ${SINTABLE}
	${RM} $@
	./${SINTABLE} > $@

clean::
	${RM} sintable.h
